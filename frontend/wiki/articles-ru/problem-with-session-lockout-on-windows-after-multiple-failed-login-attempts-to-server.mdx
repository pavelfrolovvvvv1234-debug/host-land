# Блокировка сессии на Windows после неудачных попыток входа

Проблема возникает, когда Windows Server блокирует учётную запись после нескольких неудачных попыток входа через RDP.

## Описание проблемы

После нескольких неправильных вводов пароля при подключении по RDP:

- Учётная запись блокируется
- Невозможно войти даже с правильным паролем
- Появляется сообщение о блокировке аккаунта
- Требуется ручная разблокировка

## Причина

Windows Server имеет политику безопасности **Account Lockout Policy**, которая:

- Блокирует учётную запись после N неудачных попыток
- По умолчанию: 5 попыток
- Длительность блокировки: 30 минут (по умолчанию)

## Решение

### Метод 1: Подождать

Просто подождите 30 минут (или время блокировки по вашей политике).

### Метод 2: Разблокировать через другого администратора

Если есть доступ под другим админ-аккаунтом:

1. Войдите под другим админом
2. Откройте **Computer Management**
3. Перейдите в **Local Users and Groups** → **Users**
4. Найдите заблокированного пользователя
5. Снимите галочку **Account is locked out**

### Метод 3: Через KVM/IPMI

Если есть доступ к KVM:

1. Войдите через KVM консоль
2. Используйте локальный вход
3. Разблокируйте через Computer Management

### Метод 4: Через PowerShell (если есть доступ)

```powershell
# Разблокировать пользователя
Unlock-ADAccount -Identity "username"

# Или для локальных пользователей
net user username /active:yes
```

## Предотвращение проблемы

### Настройка политики блокировки

**Увеличить количество попыток:**

1. Откройте **Local Security Policy** (`secpol.msc`)
2. Перейдите в **Account Policies** → **Account Lockout Policy**
3. Настройте:
   - **Account lockout threshold:** 10 попыток (вместо 5)
   - **Account lockout duration:** 15 минут (вместо 30)
   - **Reset account lockout counter after:** 15 минут

### Отключить блокировку (не рекомендуется)

Установите **Account lockout threshold** в `0` (отключает блокировку).

⚠️ **Внимание:** Это снижает безопасность!

## Альтернативные решения

### Использование SSH вместо RDP

Установите OpenSSH Server на Windows:

```powershell
# PowerShell от администратора
Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
Start-Service sshd
Set-Service -Name sshd -StartupType 'Automatic'
```

Преимущества:
- Меньше блокировок
- Можно использовать SSH-ключи
- Легче автоматизация

### Использование VPN

Подключайтесь к серверу через VPN, затем RDP к локальному IP.

## Логи и мониторинг

### Проверка попыток входа

Откройте **Event Viewer** → **Windows Logs** → **Security**

Ищите события:
- **4625** — Failed logon
- **4740** — Account lockout

## Безопасность

### Рекомендации:

✅ Используйте сложные пароли  
✅ Включите NLA (Network Level Authentication)  
✅ Ограничьте RDP по IP через firewall  
✅ Используйте нестандартный порт для RDP  
✅ Настройте VPN для доступа  

❌ Не отключайте блокировку полностью  
❌ Не используйте слабые пароли  

## FAQ

### Как быстро разблокировать аккаунт?
Через KVM консоль или подождать время блокировки.

### Можно ли отключить блокировку?
Можно, но не рекомендуется из соображений безопасности.

### Как узнать, кто пытался войти?
Проверьте Event Viewer → Security → Event ID 4625.

### Что делать, если нет KVM?
Свяжитесь с поддержкой хостинга для разблокировки.

---

**Нужен Windows сервер?** [Заказать VDS с Windows](/ru/services/vds)

