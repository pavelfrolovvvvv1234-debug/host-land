# Исправление 502 ошибки

502 ошибка означает, что Nginx не может подключиться к Next.js приложению. Выполните эти шаги:

## Шаг 1: Проверьте что приложение запущено

Подключитесь к серверу:
```bash
ssh root@95.182.98.171
```

Проверьте PM2:
```bash
pm2 list
```

Если процесса `dior-host` нет или он не `online`, запустите:
```bash
cd /var/www/host-land
npm install --production
pm2 start npm --name "dior-host" -- start
pm2 save
```

## Шаг 2: Проверьте что приложение слушает порт 3000

```bash
netstat -tlnp | grep 3000
# или
ss -tlnp | grep 3000
```

Должно быть что-то вроде:
```
tcp  0  0  0.0.0.0:3000  0.0.0.0:*  LISTEN  12345/node
```

Если порт не слушается, проверьте логи:
```bash
pm2 logs dior-host --lines 50
```

## Шаг 3: Проверьте что приложение отвечает локально

```bash
curl http://localhost:3000
```

Должен вернуть HTML код. Если не работает - приложение не запущено или упало.

## Шаг 4: Обновите конфиг Nginx для работы с IP

Создайте/обновите конфиг:
```bash
sudo nano /etc/nginx/sites-available/dior-host
```

Скопируйте содержимое из `.github/nginx-config-ip.conf` (там уже указан IP 95.182.98.171).

Или вручную замените в конфиге:
```nginx
server_name 95.182.98.171;  # вместо your-domain.com
proxy_pass http://127.0.0.1:3000;  # вместо localhost:3000
```

## Шаг 5: Перезагрузите Nginx

```bash
sudo nginx -t  # Проверка конфига
sudo systemctl reload nginx
```

## Шаг 6: Проверьте логи Nginx

```bash
sudo tail -f /var/log/nginx/dior-host-error.log
```

Если видите ошибки подключения - приложение не запущено.

## Шаг 7: Проверьте в браузере

Откройте: `http://95.182.98.171`

## Частые проблемы:

### Приложение не запускается:
```bash
cd /var/www/host-land
pm2 logs dior-host
# Проверьте ошибки, обычно это:
# - Не установлены зависимости: npm install --production
# - Ошибка в коде: проверьте логи
# - Порт занят: lsof -i :3000
```

### Порт 3000 занят другим процессом:
```bash
lsof -i :3000
# Убейте процесс или измените порт в package.json
```

### Next.js не может найти .next папку:
```bash
cd /var/www/host-land
ls -la .next
# Если нет - нужно пересобрать: npm run build
```

### Проверка что все файлы на месте:
```bash
cd /var/www/host-land
ls -la
# Должны быть: .next/, node_modules/, package.json, public/
```

